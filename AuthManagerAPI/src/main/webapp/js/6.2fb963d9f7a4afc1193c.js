webpackJsonp([6],{361:function(e,t,i){function n(e){i(428)}var a=i(1)(i(397),i(445),n,null,null);e.exports=a.exports},397:function(e,t,i){"use strict";function n(e){e.__doneUploading=!1,e.__failed=!1,e.__uploaded=0,e.__progress=0}Object.defineProperty(t,"__esModule",{value:!0});var a=i(6),o=i.n(a),r=i(24),s=i.n(r),l=i(407),u=i.n(l),d=i(0),c=d.format.humanStorageSize;t.default={name:"s-uploader",mixins:[u.a],components:{QInputFrame:d.QInputFrame,QSpinner:d.QSpinner,QIcon:d.QIcon,QBtn:d.QBtn,QProgress:d.QProgress,QItem:d.QItem,QItemSide:d.QItemSide,QItemMain:d.QItemMain,QItemTile:d.QItemTile},props:{name:{type:String,default:"file"},headers:Object,url:{type:String,required:!0},urlFactory:{type:Function,required:!1},additionalFields:{type:Array,default:function(){return[]}},method:{type:String,default:"POST"},extensions:String,multiple:Boolean,hideUploadButton:Boolean,hideUploadProgress:Boolean,noThumbnails:Boolean,color:{type:String,default:"primary"}},data:function(){return{queue:[],files:[],uploading:!1,uploadedSize:0,totalSize:0,xhrs:[],focused:!1}},computed:{length:function(){return this.queue.length},label:function(){var e=c(this.totalSize);return this.uploading?this.progress.toFixed(2)+"% ("+c(this.uploadedSize)+" / "+e+")":this.length+" ("+e+")"},progress:function(){return this.totalSize?Math.min(99.99,this.uploadedSize/this.totalSize*100):0},addDisabled:function(){return!this.multiple&&this.length>=1}},methods:{__add:function(e){var t=this;if(!this.addDisabled){var i=Array.prototype.slice.call(e.target.files);this.$refs.file.value="",i=i.filter(function(e){return!t.queue.some(function(t){return e.name===t.name})}).map(function(e){if(n(e),e.__size=c(e.size),t.noThumbnails||!e.type.startsWith("image"))t.queue.push(e);else{var i=new FileReader;i.onload=function(i){var n=new Image;n.src=i.target.result,e.__img=n,t.queue.push(e),t.__computeTotalSize()},i.readAsDataURL(e)}return e}),this.files=this.files.concat(i),this.$emit("add",i),this.__computeTotalSize()}},__computeTotalSize:function(){this.totalSize=this.length?this.queue.map(function(e){return e.size}).reduce(function(e,t){return e+t}):0},__remove:function(e){var t=e.name,i=e.__doneUploading;this.uploading&&!i?(this.$emit("remove:abort",e,e.xhr),e.xhr.abort(),this.uploadedSize-=e.__uploaded):this.$emit("remove:"+(i?"done":"cancel"),e,e.xhr),i||(this.queue=this.queue.filter(function(e){return e.name!==t})),e.__removed=!0,this.files=this.files.filter(function(e){return e.name!==t}),this.__computeTotalSize()},__removeUploaded:function(){this.files=this.files.filter(function(e){return!e.__doneUploading}),this.__computeTotalSize()},__pick:function(){!this.addDisabled&&this.$q.platform.is.mozilla&&this.$refs.file.click()},__getUploadPromise:function(e){var t=this,i=new FormData,a=new XMLHttpRequest;try{i.append("Content-Type",e.type||"application/octet-stream"),i.append("Authorization",this.$http.api.defaults.headers.common.Authorization),i.append(this.name,e),this.additionalFields.forEach(function(e){i.append(e.name,e.value)})}catch(e){return}return n(e),e.xhr=a,new s.a(function(n,r){a.upload.addEventListener("progress",function(i){if(!e.__removed){i.percent=i.total?i.loaded/i.total:0;var n=i.percent*e.size;t.uploadedSize+=n-e.__uploaded,e.__uploaded=n,e.__progress=Math.min(99,parseInt(100*i.percent,10))}},!1),a.onreadystatechange=function(){a.readyState<4||(a.status&&a.status<400?(e.__doneUploading=!0,e.__progress=100,t.$emit("uploaded",e,a),n(e)):(e.__failed=!0,t.$emit("fail",e,a),r(a)))},a.onerror=function(){e.__failed=!0,t.$emit("fail",e,a),r(a)},(t.urlFactory?t.urlFactory(e):s.a.resolve(t.url)).then(function(e){a.open(t.method,e,!0),t.headers&&o()(t.headers).forEach(function(e){a.setRequestHeader(e,t.headers[e])}),t.xhrs.push(a),a.send(i)})})},upload:function(){var e=this,t=this.length;if(0!==t){var i=0;this.uploadedSize=0,this.uploading=!0,this.xhrs=[],this.$emit("start");var n=function(){++i===t&&(e.uploading=!1,e.xhrs=[],e.queue=e.queue.filter(function(e){return!e.__doneUploading}),e.__computeTotalSize(),e.$emit("finish"))};this.queue.map(function(t){return e.__getUploadPromise(t)}).forEach(function(e){e.then(n).catch(n)})}},abort:function(){this.xhrs.forEach(function(e){e.abort()})},reset:function(){this.abort(),this.files=[],this.queue=[],this.__computeTotalSize(),this.$emit("reset")}}}},407:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(0),a={type:Array,validator:function(e){return e.every(function(e){return"icon"in e})}},o={left:"start",center:"center",right:"end"};t.default={components:{QIcon:n.QIcon},props:{prefix:String,suffix:String,stackLabel:String,floatLabel:String,error:Boolean,disable:Boolean,color:{type:String,default:"primary"},dark:Boolean,before:a,after:a,inverted:Boolean,align:{type:String,default:"left",validator:function(e){return["left","center","right"].includes(e)}}},computed:{labelIsAbove:function(){return this.focused||this.length||this.additionalLength||this.stackLabel},alignClass:function(){return"justify-"+o[this.align]}}}},418:function(e,t,i){t=e.exports=i(353)(!1),t.push([e.i,".q-uploader{box-shadow:none}",""])},428:function(e,t,i){var n=i(418);"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);i(354)("7768044a",n,!0,{})},445:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"q-uploader"},[i("q-input-frame",{ref:"input",staticClass:"no-margin",attrs:{prefix:e.prefix,suffix:e.suffix,error:e.error,disable:e.disable,inverted:"",before:e.before,after:e.after,color:e.color,align:e.align,length:e.length,"additional-length":""}},[e._v(e._s((e.floatLabel?e.floatLabel:e.stackLabel)+"　")+"\n    "),i("div",{staticClass:"col row items-center q-input-target",domProps:{innerHTML:e._s(e.label)}}),e._v(" "),e.uploading?i("q-spinner",{staticClass:"q-if-control",attrs:{size:"24px"},slot:"after"}):e._e(),e._v(" "),e.uploading?i("q-icon",{staticClass:"q-if-control",attrs:{name:"clear"},on:{click:e.abort},slot:"after"}):e._e(),e._v(" "),e.uploading?e._e():i("q-btn",{staticClass:"q-uploader-pick-button q-if-control relative-position overflow-hidden",attrs:{name:"add",disabled:e.addDisabled},on:{click:e.__pick},slot:"after"},[e._v("選擇檔案\n      "),i("input",e._b({ref:"file",staticClass:"q-uploader-input absolute-full cursor-pointer",attrs:{type:"file",accept:e.extensions},on:{change:e.__add}},"input",{multiple:e.multiple},!0))]),e._v(" "),e.hideUploadButton||e.uploading?e._e():i("q-btn",{staticClass:"q-if-control",attrs:{name:"cloud_upload",disabled:0===e.length},on:{click:e.upload},slot:"after"},[e._v("上傳")])],1),e._v(" "),i("div",{staticClass:"q-uploader-files scroll"},e._l(e.files,function(t){return i("q-item",{key:t.name,staticClass:"q-uploader-file"},[e.hideUploadProgress?e._e():i("q-progress",{staticClass:"q-uploader-progress-bg absolute-full",attrs:{color:t.__failed?"negative":"grey",percentage:t.__progress}}),e._v(" "),e.hideUploadProgress?e._e():i("div",{staticClass:"q-uploader-progress-text absolute"},[e._v("\n        "+e._s(t.__progress)+"%\n      ")]),e._v(" "),t.__img?i("q-item-side",{attrs:{image:t.__img.src}}):i("q-item-side",{attrs:{icon:"insert_drive_file",color:e.color}}),e._v(" "),i("q-item-main",{attrs:{label:t.name,sublabel:t.__size}}),e._v(" "),i("q-item-side",{attrs:{right:""}},[i("q-item-tile",{staticClass:"cursor-pointer",attrs:{color:e.color},on:{click:function(i){e.__remove(t)}}},[e._v("移除")])],1)],1)}))],1)},staticRenderFns:[]}}});