webpackJsonp([8],{365:function(e,n,t){function i(e){t(425)}var s=t(1)(t(401),t(442),i,null,null);e.exports=s.exports},401:function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=t(116),s=t.n(i),u=t(33),a=(t.n(u),t(0));n.default={name:"MenuManage",mixins:[u.viewMixin],mounted:function(){var e=this;this.searchBackup=t.i(a.extend)({},this.search),this.menuBackup=t.i(a.extend)({},this.menu),this.menuTree=t.i(a.extend)({},this.menu),this.findMenu(this.search),this.get("getAuthApplicationPairs",this.search,function(n){n&&n.length>0&&(n.forEach(function(e){e.value=parseInt(e.value)}),n.unshift({label:"目錄",value:null}),e.apOptions=n)})},data:function(){return{search:{module:"SDB"},menuTree:{},menu:{menuId:null,parentMenuId:null,seqId:0,menuName:"",applicationId:null,module:"SDB"},searchBackup:{},menuBackup:{},menuTemp:{},menuList:[],apOptions:[],tree:[],columns:[{label:"類別",field:"applicationId",width:"50px",formatter:function(e){return e?"應用程式":"目錄"}},{label:"項目名稱",field:"menuName",width:"100px"},{label:"順序調整",field:"seqId",width:"80px"}]}},methods:{makeTree:function(e,n){var t=this,i=n.filter(function(n){return n.parentMenuId===e.menuId});if(i&&i.length>0){var s=this.menuTree.menuId===e.menuId,u=i.map(function(e){return t.makeTree(e,n)}).sort(function(e,n){return e.content.seqId-n.content.seqId});return{title:e.menuName,icon:"fa-folder-open",content:e,children:u,clicked:s,expanded:!0}}return{title:e.menuName,icon:e.applicationId?"fa-file-text":"fa-folder-open",content:e,children:[],clicked:!1,expanded:!0}},findMenu:function(){var e=this;this.get("getAuthMenuList",this.searchBackup,function(n){var t={parentMenuId:null,menuId:0,menuName:"首頁",seqId:0,applicationId:null},i=e.makeTree(t,n);e.tree=i instanceof Array?i:[i]})},findSubMenu:function(e){var n=this;null===e.applicationId&&(this.search.parentMenuId=e.menuId,this.get("getAuthMenuList",this.search,function(e){e=e.sort(function(e,n){return e.seqId-n.seqId}),n.menuList=e}))},selectMenuTree:function(e){this.menuList=[],e.content.menuId!==this.menuTree.menuId&&null===e.content.applicationId?(this.menuTree=e.content,this.findSubMenu(this.menuTree)):(this.menuTree=t.i(a.extend)({},this.menuBackup),e.clicked=!1)},selectMenu:function(){var e=this.$refs.menuTable.getChecked();this.menu=e?t.i(a.extend)({},e):t.i(a.extend)({},this.menuBackup)},addMenu:function(){this.menuTemp=t.i(a.extend)({},this.menuBackup),this.$refs.menuModal.open()},editMenu:function(){this.menuTemp=t.i(a.extend)({},this.menu),this.$refs.menuModal.open()},saveMenu:function(){var e=this;if(this.menuTemp.menuName){if(this.menuTemp.menuId){var n=this.menuList.filter(function(n){return n.menuId===e.menuTemp.menuId})[0];n.menuName=this.menuTemp.menuName,n.applicationId=this.menuTemp.applicationId}else this.menuTemp.seqId=this.menuList.length>0?Math.max.apply(Math,s()(this.menuList.map(function(e){return e.seqId})))+1:1,this.menuTemp.parentMenuId=this.menuTree.menuId,this.menuList.push(this.menuTemp);this.put("saveAuthMenu",this.menuList,function(){e.$refs.menuModal.close(),e.showSuccess("選單儲存成功",3e3),e.findMenu(),e.findSubMenu(e.menuTree),e.menu=t.i(a.extend)({},e.menuBackup)})}else this.showError("請輸入選單名稱")},refreshMenu:function(){this.findMenu(),this.findSubMenu(this.menuTree),this.menu=t.i(a.extend)({},this.menuBackup)},delMenu:function(){var e=this;this.confirm("刪除選單","是否確定刪除該選單？",function(){e.delete("deleteAuthMenu",e.menu,function(){e.showSuccess("選單刪除成功",3e3),e.refreshMenu()})})},moveTop:function(e){1!==this.menuList&&(e.seqId=0,this.reorderMenu())},moveUp:function(e){if(1!==this.menuList){var n=this.menuList.filter(function(n){return n.seqId<e.seqId}).reverse();n&&n.length>0&&(e.seqId=n[0].seqId+(n[0].seqId=e.seqId,0),this.reorderMenu())}},moveDown:function(e){if(1!==this.menuList){var n=this.menuList.filter(function(n){return n.seqId>e.seqId});n&&n.length>0&&(e.seqId=n[0].seqId+(n[0].seqId=e.seqId,0),this.reorderMenu())}},moveBottom:function(e){1!==this.menuList&&(e.seqId=99999,this.reorderMenu())},reorderMenu:function(){var e=this,n=this.menuList.sort(function(e,n){return e.seqId-n.seqId});n.forEach(function(e,n){e.seqId=n+1}),this.put("saveAuthMenu",n,function(){e.refreshMenu()})}},components:{QScrollArea:a.QScrollArea}}},415:function(e,n,t){n=e.exports=t(353)(!1),n.push([e.i,".menu-manage .q-card-actions{padding-left:0;padding-right:0}",""])},425:function(e,n,t){var i=t(415);"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);t(354)("6cc40d84",i,!0,{})},442:function(e,n){e.exports={render:function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",{staticClass:"menu-manage row",staticStyle:{padding:"0 10px"}},[t("s-card",{staticClass:"col-5",attrs:{color:"darkblue",title:"選單樹狀列表"}},[t("div",{slot:"content"},[t("q-scroll-area",{staticStyle:{height:"calc(100vh - 185px)"}},[t("s-tree",{ref:"tree",attrs:{value:e.tree},on:{click:e.selectMenuTree}})],1)],1)]),e._v(" "),t("s-card",{staticClass:"col-7",staticStyle:{"padding-left":"10px"},attrs:{color:"darkblue",title:"選單管理列表"}},[t("div",{slot:"content"},[t("div",{staticClass:"row items-center",staticStyle:{"padding-bottom":"10px"}},[t("div",{staticClass:"col row justify-center xs-gutter"},[t("div",[t("s-btn",{attrs:{color:"darkred",disable:null===e.menuTree.menuId},on:{click:e.addMenu}},[e._v("新增項目")])],1),e._v(" "),t("div",[t("s-btn",{attrs:{color:"darkred",disable:!e.menu.menuId},on:{click:e.editMenu}},[e._v("修改項目")])],1),e._v(" "),t("div",[t("s-btn",{attrs:{color:"darkred",disable:!e.menu.menuId},on:{click:e.delMenu}},[e._v("刪除項目")])],1)])]),e._v(" "),t("q-scroll-area",{staticStyle:{height:"calc(100vh - 230px)"}},[t("s-datatable",{ref:"menuTable",attrs:{source:e.menuList,striped:"",checkboxs:""},on:{checked:e.selectMenu},scopedSlots:e._u([{key:"seqId",fn:function(n){return[t("div",{staticClass:"row justify-center no-wrap"},[t("div",[t("s-btn",{staticStyle:{padding:"4px 0 0 8px"},attrs:{flat:"",small:"",icon:"fa-angle-double-up"},on:{click:function(t){e.moveTop(n.row,t)}}})],1),e._v(" "),t("div",[t("s-btn",{staticStyle:{padding:"4px 0 0 8px"},attrs:{flat:"",small:"",icon:"fa-angle-up"},on:{click:function(t){e.moveUp(n.row,t)}}})],1),e._v(" "),t("div",[t("s-btn",{staticStyle:{padding:"4px 0 0 8px"},attrs:{flat:"",small:"",icon:"fa-angle-down"},on:{click:function(t){e.moveDown(n.row,t)}}})],1),e._v(" "),t("div",[t("s-btn",{staticStyle:{padding:"4px 0 0 8px"},attrs:{flat:"",small:"",icon:"fa-angle-double-down"},on:{click:function(t){e.moveBottom(n.row,t)}}})],1)])]}}])},e._l(e.columns,function(e,n){return t("s-datatable-column",{key:n,attrs:{column:e},slot:"columns"})}))],1)],1)]),e._v(" "),t("s-modal",{ref:"menuModal",attrs:{title:"選單維護",width:"400px",height:"290px"}},[t("s-input",{attrs:{label:"項目名稱"},slot:"content",model:{value:e.menuTemp.menuName,callback:function(n){e.menuTemp.menuName=n},expression:"menuTemp.menuName"}}),e._v(" "),t("s-select",{attrs:{label:"應用程式",options:e.apOptions},slot:"content",model:{value:e.menuTemp.applicationId,callback:function(n){e.menuTemp.applicationId=n},expression:"menuTemp.applicationId"}}),e._v(" "),t("s-btn",{attrs:{color:"darkred",big:""},on:{click:e.saveMenu},slot:"action"},[e._v("儲存")]),e._v(" "),t("s-btn",{attrs:{color:"darkred",big:""},on:{click:function(n){e.$refs.menuModal.close()}},slot:"action"},[e._v("取消")])],1)],1)},staticRenderFns:[]}}});